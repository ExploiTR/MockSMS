package hacks.exploitr.mockSms;

import android.os.Bundle;
import android.os.Handler;
import android.support.v7.app.AppCompatActivity;
import android.support.v7.widget.Toolbar;
import android.view.View;
import android.widget.Button;
import android.widget.TextView;
import android.widget.Toast;

import com.google.android.gms.ads.AdRequest;
import com.google.android.gms.ads.MobileAds;
import com.google.android.gms.ads.reward.RewardItem;
import com.google.android.gms.ads.reward.RewardedVideoAd;
import com.google.android.gms.ads.reward.RewardedVideoAdListener;

import java.util.Locale;
import java.util.concurrent.TimeUnit;

import hacks.exploitr.Constants.All;
import hacks.exploitr.Constants.Extra;

public class FreeActivity extends AppCompatActivity {

    private TextView textView;
    private Toolbar toolbar;
    private Handler handler;
    private RewardedVideoAd mRewardedVideoAd;
    private Button add_time;
    private boolean showAd = false;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_free);
        setSupportActionBar(toolbar);

        toolbar = findViewById(R.id.toolbar_free);
        add_time = findViewById(R.id.add_time);
        textView = findViewById(R.id.timeText);
        handler = new Handler();

        toolbar.setTitle("Ad-Free Config");

        mRewardedVideoAd = MobileAds.getRewardedVideoAdInstance(FreeActivity.this);
        mRewardedVideoAd.loadAd(All.ID_0_REW, new AdRequest.Builder().build());
        mRewardedVideoAd.setRewardedVideoAdListener(new RewardedVideoAdListener() {
            @Override
            public void onRewardedVideoAdLoaded() {
                if (showAd) {
                    mRewardedVideoAd.show();
                }
            }

            @Override
            public void onRewardedVideoAdOpened() {

            }

            @Override
            public void onRewardedVideoStarted() {

            }

            @Override
            public void onRewardedVideoAdClosed() {
                showAd = false;
                mRewardedVideoAd.loadAd(All.ID_0_REW, new AdRequest.Builder().build());
            }

            @Override
            public void onRewarded(RewardItem rewardItem) {
                Toast.makeText(getBaseContext(),"Yahoo! you got +15",Toast.LENGTH_SHORT).show();
                if (Extra.getInstance(getBaseContext()).getAdFreeExpTimeTill() < System.currentTimeMillis()) {
                    Extra.getInstance(getBaseContext()).setAdFreeExpTimeTill(System.currentTimeMillis() + TimeUnit.MINUTES.toMillis(15));
                } else {
                    Extra.getInstance(getBaseContext())
                            .setAdFreeExpTimeTill(Extra.getInstance(getBaseContext()).getAdFreeExpTimeTill() +
                                    TimeUnit.MINUTES.toMillis(15));
                }
                showAd = false;
            }

            @Override
            public void onRewardedVideoAdLeftApplication() {

            }

            @Override
            public void onRewardedVideoAdFailedToLoad(int i) {
                add_time.setEnabled(false);
            }

            @Override
            public void onRewardedVideoCompleted() {

            }
        });

        add_time.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                if (mRewardedVideoAd.isLoaded()) {
                    mRewardedVideoAd.show();
                } else {
                    Toast.makeText(FreeActivity.this, "Wait, Ad is loading", Toast.LENGTH_SHORT).show();
                    showAd = true;
                }
            }
        });

        handler.post(new Runnable() {
            @Override
            public void run() {
                if (Extra.getInstance(getBaseContext()).getAdFreeExpTimeTill() > System.currentTimeMillis()) {
                    long difference = Extra.getInstance(getBaseContext()).getAdFreeExpTimeTill() - System.currentTimeMillis();
                    int[] all = Utils.getDifference(difference);
                    String poo = String.format(Locale.US, "You have %d days %d Hours %d Minutes and %d Seconds of Ad-Free remaining",
                            all[0],
                            all[1],
                            all[2],
                            all[3]);
                    textView.setText(poo);
                } else {
                    String poo = String.format(Locale.US, "You have %d days %d Hours %d Minutes and %d Seconds of Ad-Free remaining",
                            0, 0, 0, 0);
                    textView.setText(poo);
                }
                handler.postDelayed(this, 1000);
            }
        });
    }
}
